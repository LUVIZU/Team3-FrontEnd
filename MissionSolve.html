<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>미션</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      .blur-circle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        z-index: 0;
      }

      .blur-circle-1 {
        width: 783px;
        height: 783px;
        background: #ddf2ff;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        filter: blur(500px);
        opacity: 1;
      }

      .blur-circle-2 {
        width: 507px;
        height: 507px;
        background: #b0dcf7;
        top: 240px;
        left: 60%;
        transform: translateX(-50%);
        filter: blur(250px);
        opacity: 0.2;
      }

      .header,
      .wrapper,
      .sidebar,
      .content {
        position: relative;
        z-index: 10;
      }

      .logo img {
        width: 128px;
        height: 52px;
      }

      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        padding-top: 100px;
      }

      .wrapper {
        width: 90vw;
        max-width: 1280px;
        margin: 0 auto;
        padding-top: 20px;
        display: flex;
        flex-direction: row;
        gap: 0;
      }

      .header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 80px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 5vw;
        z-index: 1000;
      }

      .header .user-actions {
        display: flex;
        align-items: center;
        width: auto;
        height: 42px;
        gap: 14px;
      }

      .nav-box {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 37px;
        padding: 10px 14px;
        font-size: 20px;
        font-weight: 500;
        border-right: 1px solid #e1e1e1;
        position: relative;
      }

      .notification {
        position: relative;
      }

      .badge {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 18px;
        height: 18px;
        background: #ff3b3b;
        color: white;
        font-size: 12px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .profile-btn {
        width: 37px;
        height: 37px;
        border: 1px solid #247eb6;
        border-radius: 1000px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
      }

      .profile-btn img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .sidebar {
        width: 280px;
        height: auto;
        padding: 2px;
        background-color: white;
        border-top: 5px solid #247eb6;
        flex-shrink: 0;
        flex-grow: 0;
      }

      .sidebar h2 {
        color: #247eb6;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 36px;
        margin-top: 30px;
        text-align: center;
      }

      .stats {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10.67px;
        margin-top: 15px;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 16px;
        color: #000;
      }

      .stat-item img.user-icon {
        width: 26.27px;
        height: 20.3px;
      }

      .stat-item img.calendar-icon {
        width: 18.67px;
        height: 18.67px;
      }

      .stat-item img.day-icon {
        width: 13.33px;
        height: 17px;
      }

      .write-button {
        margin: 20px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 200px;
        height: 40px;
        background-color: #b0dcf7;
        border-radius: 21.02px;
        gap: 7.01px;
        color: white;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
      }

      .write-button img {
        width: 18px;
        height: 18px;
      }

      .sidebar ul {
        list-style: none;
        margin-top: 20px;
        padding: 0 15px;
      }

      .sidebar li {
        display: flex;
        margin-bottom: 10px;
        cursor: pointer;
        align-items: center;
        flex-wrap: wrap;
      }

      .sidebar li .menu-item-link,
      .sidebar li .mission-main-link {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: black;
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        transition: background-color 0.2s, color 0.2s;
      }

      .sidebar li .menu-item-link.active,
      .sidebar li .mission-main-link.active {
        background-color: #e6f4fd;
      }

      .sidebar li .menu-item-link.active span,
      .sidebar li .mission-main-link.active span {
        color: #247eb6;
        font-weight: 600;
      }

      .sidebar li[data-icon="group"] {
        border-bottom: 1px solid #e1e1e1;
        padding-bottom: 20px;
        margin-bottom: 10px;
      }
      .sidebar li[data-icon="mission"] {
        border-bottom: 1px solid #e1e1e1;
        padding-bottom: 20px;
        margin-bottom: 10px;
      }
      .sidebar li[data-icon="calendar"] {
        border-bottom: 1px solid #e1e1e1;
        padding-bottom: 20px;
        margin-bottom: 10px;
      }

      #mission-submenu {
        padding-left: 0;
        list-style: none;
        display: none;
        margin-top: 5px;
        width: 100%;
      }

      #mission-submenu li {
        display: block;
        padding: 0;
        margin-bottom: 5px;
        border-radius: 0;
      }

      #mission-submenu li a {
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        color: black;
        width: 100%;
        padding: 8px 15px 8px 30px;
        border-radius: 8px;
        transition: background-color 0.2s, color 0.2s, border 0.2s;
        white-space: nowrap;
      }

      #mission-submenu li a img {
        width: 16px;
        height: 16px;
      }

      #mission-submenu li a.active {
        background-color: #e6f4fd;
        color: #247eb6;
        font-weight: 600;
        border: 1px solid #247eb6;
      }

      #mission-submenu li a.active span {
        color: #247eb6;
        font-weight: 600;
      }

      #mission-submenu li:last-child {
        margin-bottom: 0;
      }

      .icon-all {
        width: 26px;
        height: 26px;
      }
      .icon-star {
        width: 27px;
        height: 26px;
      }
      .icon-info {
        width: 27px;
        height: 26px;
      }
      .icon-group {
        width: 37px;
        height: 26px;
      }
      .icon-mission {
        width: 20.8px;
        height: 26px;
      }
      .icon-calendar {
        width: 26px;
        height: 26px;
      }

      .content {
        flex: 1;
        padding: 0 40px;
        display: flex;
        padding-top: 30px;
        flex-direction: column;
        margin-left: 22px;
      }

      .mission-container {
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        width: 900px;
        height: 100%;
        margin: 0 auto;
        padding-bottom: 10px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        border-top-right-radius: 15px;
        overflow: hidden;
      }

      .mission-top-bar {
        display: flex;
        justify-content: flex-end;
        width: 100%;
        height: 50px;
      }

      .gray-triangle {
        width: 0;
        height: 0;
        border-top: 50px solid transparent;
        border-right: 52px solid #e8e8e8;
        flex-shrink: 0;
      }

      .gray-box-right {
        width: 400px;
        background-color: #e8e8e8;
        height: 100%;
        border-top-right-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .mission-icon {
        width: 20px;
        height: 20px;
      }

      .mission-title {
        font-size: 22px;
        font-weight: 600;
        color: #247eb6;
      }

      .question-body {
        padding: 30px 40px 0;
      }

      .question-text {
        font-size: 20px;
        line-height: 1.5;
        margin-bottom: 30px;
      }

      .answer-options {
        display: flex;
        flex-direction: column;
        padding-bottom: 30px;
        gap: 15px;
      }

      .answer-option {
        padding: 15px 20px;
        border: 1px solid #e1e1e1;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .answer-option:hover {
        background-color: #f0f8ff;
      }

      .answer-option.selected {
        background-color: #e6f4fd;
        border-color: #247eb6;
      }

      .choice-buttons {
        display: flex;
        justify-content: space-around;
        margin-top: 40px;
      }

      .choice-button {
        width: 120px;
        height: 50px;
        border-radius: 10px;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f3faff;
        border: 1px solid #e6f4fd;
        color: #247eb6;
        transition: background-color 0.2s, border-color 0.2s;
      }

      .choice-button:hover {
        background-color: #e6f4fd;
      }

      #mission-submenu {
        padding-left: 0;
        list-style: none;
        display: none;
        margin-top: 5px;
        width: 100%;
      }

      #mission-submenu li {
        display: block;
        padding: 0;
        margin-bottom: 5px;
        border-radius: 0;
      }

      #mission-submenu li a {
        display: flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        color: black;
        width: 100%;
        padding: 8px 15px 8px 30px;
        border-radius: 8px;
        transition: background-color 0.2s, color 0.2s, border 0.2s;
        white-space: nowrap;
      }

      #mission-submenu li a img {
        width: 16px;
        height: 16px;
      }

      #mission-submenu li a.active {
        background-color: #e6f4fd;
        color: #247eb6;
        font-weight: 600;
        border: 1px solid #247eb6;
      }

      #mission-submenu li:last-child {
        margin-bottom: 0;
      }
    </style>
  </head>

  <body>
    <div class="blur-circle blur-circle-1"></div>
    <div class="blur-circle blur-circle-2"></div>
    <div class="header">
      <div class="logo">
        <img src="./icons/tutti.png" alt="Tutti 로고" />
      </div>
      <div class="user-actions">
        <div class="nav-box" onclick="location.href='CommuForm.html'">홈</div>
        <div
          class="nav-box notification"
          onclick="location.href='MyPageAlerts.html'"
        >
          알림
          <span class="badge">0</span>
        </div>
        <div class="profile-btn" onclick="location.href='MyPage.html'">
          <img id="profileImage" src="./icons/profile.png" alt="프로필" />
        </div>
      </div>
    </div>

    <div class="wrapper">
      <div class="sidebar">
        <h2>TOEIC 커뮤니티</h2>
        <div class="stats">
          <div class="stat-item">
            <img src="./icons/user.png" class="user-icon" alt="유저 아이콘" />
            <span>85명</span>
          </div>
          <div class="stat-item">
            <img
              src="./icons/calendar-blue.png"
              class="calendar-icon"
              alt="달력 아이콘"
            />
            <span>8/24</span>
          </div>
          <div class="stat-item">
            <img src="./icons/day.png" class="day-icon" alt="D-day 아이콘" />
            <span>D-61</span>
          </div>
        </div>

        <div class="write-button">
          <img src="./icons/pencil.png" alt="글쓰기 아이콘" />
          <span>글쓰기</span>
        </div>

        <ul id="menu-list">
          <li data-title="전체글" data-icon="all" class="menu-item">
            <a href="Community.html" class="menu-item-link">
              <img src="./icons/all-gray.png" class="icon-all" />
              <span>전체글</span>
            </a>
          </li>

          <li data-title="인기글" data-icon="star" class="menu-item">
            <a href="hot.html" class="menu-item-link">
              <img src="./icons/star-gray.png" class="icon-star" />
              <span>인기글</span>
            </a>
          </li>

          <li data-title="정보글" data-icon="info" class="menu-item">
            <a href="Info.html" class="menu-item-link">
              <img src="./icons/info-gray.png" class="icon-info" />
              <span>정보글</span>
            </a>
          </li>

          <li data-title="스터디 모집" data-icon="group" class="menu-item">
            <a href="group.html" class="menu-item-link">
              <img src="./icons/group-gray.png" class="icon-group" />
              <span>스터디 모집</span>
            </a>
          </li>

          <li
            id="mission-menu"
            data-title="미션"
            data-icon="mission"
            class="menu-item"
          >
            <a href="Mission.html" class="mission-main-link">
              <img src="./icons/mission-blue.png" class="icon-mission" />
              <span>미션</span>
            </a>
            <ul id="mission-submenu">
              <li>
                <a href="MissionSolve.html">
                  <img src="./icons/question.png" alt="•" />
                  <span>미션풀기</span>
                </a>
              </li>
              <li>
                <a href="WrongNote.html">
                  <img src="./icons/question.png" alt="•" />
                  <span>오답노트</span>
                </a>
              </li>
            </ul>
          </li>

          <li data-title="시험 일정" data-icon="calendar" class="menu-item">
            <a href="Calendar.html" class="menu-item-link">
              <img src="./icons/calendar-gray.png" class="icon-calendar" />
              <span>시험 일정</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="content">
        <div class="mission-container">
          <div class="mission-top-bar">
            <div class="gray-triangle"></div>

            <div class="gray-box-right">
              <img
                src="./icons/mission-blue.png"
                alt="미션"
                class="mission-icon"
              />
              <span class="mission-title">미션</span>
            </div>
          </div>
          <div class="question-body">
            <div class="question-text">문제를 로드 중입니다...</div>
            <div class="answer-options"></div>
            <div class="choice-buttons"></div>
          </div>
        </div>
      </div>
    </div>

    <script src="./config.js"></script>

    <script>
      const missionMenu = document.getElementById("mission-menu");
      const subMenu = document.getElementById("mission-submenu");
      const mainMissionLink = missionMenu.querySelector(".mission-main-link");
      const mainMissionIcon = mainMissionLink.querySelector(".icon-mission");

      function updateIconSrc(imgElement, isActive, defaultSrc, activeSrc) {
        if (!imgElement) return;
        if (isActive) {
          imgElement.src = activeSrc;
        } else {
          imgElement.src = defaultSrc;
        }
      }

      if (missionMenu) {
        missionMenu.addEventListener("click", (event) => {
          const clickedLink = event.target.closest("a");

          if (
            clickedLink &&
            clickedLink.classList.contains("mission-main-link")
          ) {
            const isVisible = subMenu.style.display === "block";
            subMenu.style.display = isVisible ? "none" : "block";

            updateIconSrc(
              mainMissionIcon,
              false,
              "./icons/mission-gray.png",
              "./icons/mission-blue.png"
            );
            mainMissionLink.classList.remove("active");

            subMenu.querySelectorAll("a").forEach((subLink) => {
              subLink.classList.remove("active");
              subLink.querySelector("img").src = "./icons/question.png";
            });
          } else if (clickedLink && subMenu.contains(clickedLink)) {
            subMenu.querySelectorAll("a").forEach((subLink) => {
              subLink.classList.remove("active");
              subLink.querySelector("img").src = "./icons/question.png";
            });

            clickedLink.classList.add("active");

            mainMissionLink.classList.remove("active");
            updateIconSrc(
              mainMissionIcon,
              false,
              "./icons/mission-gray.png",
              "./icons/mission-blue.png"
            );
          }
        });
      }

      window.addEventListener("DOMContentLoaded", () => {
        const menuItems = document.querySelectorAll(".menu-item");
        const currentPath = window.location.pathname.split("/").pop();

        menuItems.forEach((item) => {
          const linksInItem = item.querySelectorAll(
            "a.menu-item-link, a.mission-main-link, #mission-submenu a"
          );
          let isActiveMenuItem = false;

          linksInItem.forEach((link) => {
            if (link.getAttribute("href") === currentPath) {
              link.classList.add("active");
              isActiveMenuItem = true;

              const img = link.querySelector("img");
              if (img) {
                if (
                  link.classList.contains("menu-item-link") &&
                  !link.classList.contains("mission-main-link")
                ) {
                  updateIconSrc(
                    img,
                    true,
                    img.src.replace("-blue", "-gray"),
                    img.src.replace("-gray", "-blue")
                  );
                } else if (subMenu.contains(link)) {
                  // 미션 서브메뉴 아이템 (question.png는 변경되지 않음)
                  // 서브메뉴 항목을 클릭했을 때 메인 미션 아이콘을 파란색으로 변경 (미션 섹션 활성화)
                  updateIconSrc(
                    mainMissionIcon,
                    true,
                    "./icons/mission-gray.png",
                    "./icons/mission-blue.png"
                  );
                } else if (link.classList.contains("mission-main-link")) {
                  // 미션 메인 링크 자체 ( Mission.html 로드 시)
                  updateIconSrc(
                    img,
                    true,
                    "./icons/mission-gray.png",
                    "./icons/mission-blue.png"
                  );
                }
              }
            } else {
              // 현재 페이지가 아닌 링크
              link.classList.remove("active");
              if (
                !subMenu.contains(link) && // 서브메뉴 링크가 아니고
                !link.classList.contains("mission-main-link") // 메인 미션 링크가 아닌 경우
              ) {
                const img = link.querySelector("img");
                if (img && img.src.includes("-blue")) {
                  img.src = img.src.replace("-blue", "-gray");
                }
              }
            }
          });

          // 특정 미션 관련 페이지일 때 서브메뉴 자동 열림
          if (item.id === "mission-menu") {
            const subMenu = item.querySelector("#mission-submenu");
            if (subMenu) {
              if (
                currentPath === "Mission.html" ||
                currentPath === "MissionSolve.html" ||
                currentPath === "WrongNote.html"
              ) {
                subMenu.style.display = "block";

                const mainMissionLink =
                  item.querySelector(".mission-main-link");
                if (mainMissionLink) {
                  // 미션 서브 페이지에 있을 때 메인 미션 아이콘을 파란색으로 표시
                  updateIconSrc(
                    mainMissionIcon,
                    true, // 활성 상태로 표시
                    "./icons/mission-gray.png",
                    "./icons/mission-blue.png"
                  );
                }
              } else {
                subMenu.style.display = "none";
                const mainMissionLink =
                  item.querySelector(".mission-main-link");
                if (mainMissionLink) {
                  // 미션 관련 페이지가 아닐 때 메인 미션 아이콘을 회색으로 표시
                  updateIconSrc(
                    mainMissionIcon,
                    false,
                    "./icons/mission-gray.png",
                    "./icons/mission-blue.png"
                  );
                }
              }
            }
          }
        });

        // ====================================================================
        // 이 아래부터 백엔드 API 연동 및 문제 로딩 로직입니다.
        // 기존의 하드코딩된 answerOptions, choiceButtons 이벤트 리스너는 제거합니다.
        // ====================================================================

        const questionTextElement = document.querySelector(".question-text");
        const answerOptionsContainer =
          document.querySelector(".answer-options");
        const choiceButtonsContainer =
          document.querySelector(".choice-buttons");

        // 미션 문제 데이터를 가져오는 함수
        async function fetchMissionQuestion(communityId) {
          try {
            // 확인된 Swagger 명세에 따른 API URL
            const token = localStorage.getItem("accessToken");

            const response = await fetch(
              `${window.BASE_URL}/api/communities/${communityId}/missions/problem`,
              {
                method: "GET",
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            );
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const responseData = await response.json(); // 전체 응답 객체
            if (responseData.status === "success" && responseData.data) {
              return responseData.data; // 실제 문제 데이터는 'data' 필드 안에 있음
            } else {
              console.error(
                "API 응답에서 문제 데이터를 찾을 수 없습니다:",
                responseData.message
              );
              return null;
            }
          } catch (error) {
            console.error("미션 문제를 가져오는 데 실패했습니다:", error);
            questionTextElement.textContent =
              "문제를 불러오는 데 실패했습니다. 잠시 후 다시 시도해주세요.";
            answerOptionsContainer.innerHTML = "";
            choiceButtonsContainer.innerHTML = "";
            return null;
          }
        }

        // 문제를 렌더링하는 함수
        function renderQuestion(problem) {
          if (!problem) {
            questionTextElement.textContent = "문제를 표시할 수 없습니다.";
            answerOptionsContainer.innerHTML = "";
            choiceButtonsContainer.innerHTML = "";
            return;
          }

          // 문제 텍스트 설정: problem.content 사용
          questionTextElement.textContent = problem.content;
          answerOptionsContainer.innerHTML = ""; // 기존 보기들을 비웁니다.
          choiceButtonsContainer.innerHTML = ""; // 기존 선택 버튼들을 비웁니다.

          // 보기에 사용할 알파벳 레이블 (A, B, C, D) 생성
          const choiceLabels = ["A", "B", "C", "D", "E", "F"]; // 최대 보기 개수에 맞게 확장 가능

          problem.options.forEach((optionText, index) => {
            // problem.options는 문자열 배열이므로 직접 사용
            const choiceLabel = choiceLabels[index]; // 'A', 'B', 'C' 등

            // 보기 렌더링
            const answerOptionDiv = document.createElement("div");
            answerOptionDiv.classList.add("answer-option");
            answerOptionDiv.dataset.choice = optionText; // data-choice에 보기 텍스트 자체를 저장
            answerOptionDiv.textContent = `(${choiceLabel}) ${optionText}`; // (A) diligent
            answerOptionsContainer.appendChild(answerOptionDiv);

            // 선택 버튼 렌더링
            const choiceButtonDiv = document.createElement("div");
            choiceButtonDiv.classList.add("choice-button");
            choiceButtonDiv.dataset.choice = optionText; // 선택 버튼도 보기 텍스트 자체를 data-choice로 가짐
            choiceButtonDiv.textContent = choiceLabel; // 버튼에는 A, B, C, D 표시
            choiceButtonsContainer.appendChild(choiceButtonDiv);
          });

          // 문제 ID를 숨겨진 요소에 저장하여 나중에 답변 제출 시 사용
          let hiddenProblemIdInput =
            document.getElementById("currentProblemId");
          if (!hiddenProblemIdInput) {
            hiddenProblemIdInput = document.createElement("input");
            hiddenProblemIdInput.type = "hidden";
            hiddenProblemIdInput.id = "currentProblemId";
            document.body.appendChild(hiddenProblemIdInput); // body에 추가
          }
          hiddenProblemIdInput.value = problem.problemId;

          // 렌더링 후 이벤트 리스너 다시 연결
          addAnswerOptionListeners();
          addChoiceButtonListeners();
        }

        // 보기 선택 이벤트 리스너 함수
        function addAnswerOptionListeners() {
          const currentAnswerOptions =
            document.querySelectorAll(".answer-option");
          currentAnswerOptions.forEach((option) => {
            option.addEventListener("click", () => {
              currentAnswerOptions.forEach((opt) =>
                opt.classList.remove("selected")
              );
              option.classList.add("selected");
            });
          });
        }

        // 선택 버튼 이벤트 리스너 함수
        function addChoiceButtonListeners() {
          const currentChoiceButtons =
            document.querySelectorAll(".choice-button");
          const currentAnswerOptions =
            document.querySelectorAll(".answer-option");
          currentChoiceButtons.forEach((button) => {
            button.addEventListener("click", () => {
              currentAnswerOptions.forEach((opt) =>
                opt.classList.remove("selected")
              );
              const selectedOption = document.querySelector(
                `.answer-option[data-choice="${button.dataset.choice}"]`
              );
              if (selectedOption) {
                selectedOption.classList.add("selected");
              }
            });
          });
        }

        // 페이지 로드 시 미션 문제 가져오기
        // communityId를 URL에서 가져오는 대신, 무조건 '1'로 설정합니다.
        const communityId = "1"; // 커뮤니티 ID를 1로 고정

        if (communityId) {
          // fetch 요청을 보내기 전에 communityId 값 확인
          console.log("요청할 communityId:", communityId);

          fetchMissionQuestion(communityId).then((problemData) => {
            renderQuestion(problemData);
          });
        } else {
          console.warn(
            "communityId가 설정되지 않아 문제를 불러올 수 없습니다."
          );
          questionTextElement.textContent =
            "커뮤니티 ID가 없어 문제를 불러올 수 없습니다. 미션 목록에서 미션을 선택해주세요.";
          answerOptionsContainer.innerHTML = "";
          choiceButtonsContainer.innerHTML = "";
        }

        // **새롭게 추가: 답변 제출 로직**
        // 실제 제출 버튼 HTML 요소를 만들어 연결하는 것이 더 좋음.
        // 여기서는 임시로 JavaScript로 버튼을 생성하여 연결합니다.
        const submitButton = document.createElement("button");
        submitButton.textContent = "답변 제출";
        submitButton.style.marginTop = "20px";
        submitButton.style.padding = "10px 20px";
        submitButton.style.backgroundColor = "#247eb6";
        submitButton.style.color = "white";
        submitButton.style.border = "none";
        submitButton.style.borderRadius = "5px";
        submitButton.style.cursor = "pointer";
        submitButton.onclick = async () => {
          const selectedOption = document.querySelector(
            ".answer-option.selected"
          );
          const currentProblemId =
            document.getElementById("currentProblemId").value;

          if (!selectedOption) {
            alert("답변을 선택해주세요!");
            return;
          }
          if (!currentProblemId) {
            alert("문제 ID를 찾을 수 없습니다. 다시 로드해주세요.");
            return;
          }

          const selectedAnswerValue = selectedOption.dataset.choice; // 선택된 보기의 data-choice 값

          try {
            const response = await fetch(
              `/api/problem/${currentProblemId}/submit`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ selectedAnswer: selectedAnswerValue }),
              }
            );

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            console.log("제출 결과:", result);

            // 사용자에게 결과 피드백
            if (result.status === "success") {
              // Swagger 응답 스키마와 일치하도록 result.data.correct/explanation 사용
              if (result.data && typeof result.data.correct !== "undefined") {
                if (result.data.correct) {
                  alert("정답입니다!\n" + (result.data.explanation || ""));
                } else {
                  alert("오답입니다. ㅠㅠ\n" + (result.data.explanation || ""));
                }
              } else {
                alert("답변이 제출되었습니다. 결과 데이터가 불완전합니다.");
              }

              // 다음 문제 로드 로직
              // alert 창이 닫힌 후 다음 문제를 로드하도록 setTimeout 추가 (UX 개선)
              setTimeout(async () => {
                const nextProblemData = await fetchMissionQuestion(communityId);
                renderQuestion(nextProblemData);
              }, 100); // 0.1초 후에 다음 문제 로드
            } else {
              alert("답변 제출 실패: " + result.message);
            }
          } catch (error) {
            console.error("답변 제출 중 오류 발생:", error);
            alert("답변 제출 중 네트워크 오류가 발생했습니다.");
          }
        };

        // 제출 버튼을 question-body 내부에 추가 (또는 원하는 위치에)
        const questionBody = document.querySelector(".question-body");
        if (questionBody) {
          questionBody.appendChild(submitButton);
        }
      });
    </script>
  </body>
</html>
