<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시물 상세 페이지</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      .blur-circle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        z-index: 0;
      }

      .header,
      .wrapper,
      .sidebar,
      .content {
        position: relative;
        z-index: 10;
      }

      .blur-circle-1 {
        width: 783px;
        height: 783px;
        background: #ddf2ff;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        filter: blur(500px);
        opacity: 1;
      }

      .blur-circle-2 {
        width: 507px;
        height: 507px;
        background: #b0dcf7;
        top: 240px;
        left: 60%;
        transform: translateX(-50%);
        filter: blur(250px);
        opacity: 0.2;
      }

      .logo img {
        width: 128px;
        height: 52px;
      }

      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        padding-top: 100px;
      }

      .wrapper {
        width: 90vw;
        max-width: 1280px;
        padding-top: 20px;
        display: flex;
        flex-direction: row;
        gap: 0;
      }

      .header {
        position: absolute;
        top: 10px;
        left: 0;
        width: 100%;
        height: 80px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 5vw;
        z-index: 1000;
      }

      .header .user-actions {
        display: flex;
        align-items: center;
        width: auto;
        height: 42px;
        gap: 14px;
      }

      .nav-box {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 37px;
        padding: 10px 14px;
        font-family: "Inter", sans-serif;
        font-size: 20px;
        font-weight: 500;
        border-right: 1px solid #e1e1e1;
        position: relative;
        background-color: #f9f9f9;
      }

      .notification {
        position: relative;
      }

      .badge {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 18px;
        height: 18px;
        background: #ff3b3b;
        color: white;
        font-size: 12px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .profile-btn {
        width: 37px;
        height: 37px;
        border: 1px solid #247eb6;
        border-radius: 1000px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
      }

      .profile-btn img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .sidebar {
        width: 280px;
        height: auto;
        padding: 2px;
        background-color: white;
        border-top: 5px solid #247eb6;
        flex-shrink: 0;
        flex-grow: 0;
      }

      .sidebar h2 {
        color: #247eb6;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 36px;
        margin-top: 30px;
        text-align: center;
      }

      .stats {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10.67px;
        margin-top: 15px;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 16px;
        color: #000;
      }

      .stat-item img.user-icon {
        width: 26.27px;
        height: 20.3px;
      }

      .stat-item img.calendar-icon {
        width: 18.67px;
        height: 18.67px;
      }

      .stat-item img.day-icon {
        width: 13.33px;
        height: 17px;
      }

      .write-button {
        margin: 20px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 200px;
        height: 40px;
        background-color: #b0dcf7;
        border-radius: 21.02px;
        gap: 7.01px;
        color: white;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
      }

      .write-button img {
        width: 18px;
        height: 18px;
      }

      .sidebar ul {
        list-style: none;
        margin-top: 20px;
        padding: 0 15px;
      }

      .sidebar li {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: pointer;
      }

      .sidebar li.active {
        background-color: #e6f4fd;
      }

      .sidebar li.active span {
        color: #247eb6;
        font-weight: 600;
      }

      .icon-all {
        width: 26px;
        height: 26px;
      }
      .icon-star {
        width: 27px;
        height: 26px;
      }
      .icon-info {
        width: 27px;
        height: 26px;
      }
      .icon-group {
        width: 37px;
        height: 26px;
      }
      .icon-mission {
        width: 20.8px;
        height: 26px;
      }
      .icon-calendar {
        width: 26px;
        height: 26px;
      }

      .content {
        flex: 1;
        padding-left: 30px;
        display: flex;
        flex-direction: column;
      }

      .post-detail {
        background-color: #ffffff;
        border-radius: 15px;
        padding: 25px 40px;
        width: 100%;
        min-height: 450px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
      }

      .post-header {
        font-size: 16px;
        color: #a0a0a0;
        margin-bottom: 15px;
        padding-bottom: 0px;
        border-bottom: none;
      }

      .post-header a {
        color: #a0a0a0;
        text-decoration: none;
      }

      .post-header a span {
        color: #247eb6;
      }

      .post-title {
        font-family: "Inter", sans-serif;
        font-size: 32px;
        font-weight: 600;
        color: #000;
        margin-bottom: 20px;
        line-height: 1.4;
      }

      .post-meta {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
        font-size: 16px;
        color: #888;
      }

      .post-meta .profile-and-text {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .post-meta .text-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 5px;
      }

      .post-meta span#post-writer {
        font-weight: 600;
        font-size: 18px;
        line-height: 1.2;
      }

      .post-meta span#post-date {
        font-weight: 400;
        font-size: 16px;
        line-height: 1.2;
        color: #939393;
      }

      .meta-and-line {
        border-bottom: 2.06px solid #e1e1e1;
        margin-bottom: 30px;
      }

      .profile-img-small {
        width: 58px;
        height: 58px;
        border-radius: 50%;
        background-color: #b0dcf7;
        overflow: hidden;
        flex-shrink: 0;
      }

      .profile-img-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .post-content {
        font-size: 18px;
        color: #000;
        line-height: 1.7;
        text-align: center;
        padding-left: 0;
        padding-right: 0;
        flex-grow: 1;
      }

      .post-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 60px;
        margin-top: 30px;
      }

      .post-actions .left-actions {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .post-actions .right-actions {
        display: flex;
        align-items: center;
      }

      .action-item {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 16px;
        color: #555;
        gap: 5px;
      }

      .action-item .heart-icon {
        width: 35px;
        height: 32px;
      }

      .action-item .comment-icon {
        width: 37px;
        height: 31px;
      }

      .action-item .bookmark-icon {
        width: 26px;
        height: 35px;
        transition: transform 0.2s ease-in-out;
      }

      .comments-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
      }

      .comment-input-area {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-top: 10px;
        padding: 0 80px;
        padding-bottom: 30px;
      }

      .comment-input-area .profile-img-small {
        flex-shrink: 0;
        width: 48px;
        height: 48px;
      }

      .comment-input-area input {
        flex-grow: 1;
        padding: 10px 12px;
        border: 1px solid #e1e1e1;
        border-radius: 8px;
        font-size: 15px;
        outline: none;
        height: 60px;
      }

      .comment-input-area input::placeholder {
        color: #c6c6c6;
      }

      .comment-input-area button {
        padding: 10px 18px;
        background-color: #f0f9ff;
        color: #247eb6;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        flex-shrink: 0;
      }

      .comment-input-area button:hover {
        background-color: #1a6096;
      }

      .comments-list {
        display: flex;
        flex-direction: column;
        gap: 0;
        padding-top: 0px;
      }

      .comment-item {
        display: flex;
        gap: 15px;
        align-items: flex-start;
        padding: 0px;
        border-bottom: none;
        background-color: transparent;
      }

      .comment-item:first-child {
        padding: 10px 0;
      }

      .comment-item:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }

      .reply-comment-item {
        margin-left: 40px;
        padding-left: 0;
        background-color: transparent;
        border: none;
      }

      .reply-comment-item + .reply-comment-item {
        border-top: none !important; /* 위 답글과의 선 제거 */
        margin-top: 0px;
      }

      .reply-arrow-image {
        width: 16px;
        height: 16px;
        margin-top: 6px;
        flex-shrink: 0;
      }

      .reply-comment-item .profile-img-small {
        width: 36px;
        height: 36px;
        flex-shrink: 0;
        margin-top: 4px;
        z-index: 2;
      }

      .reply-comment-item .comment-content-area {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        margin-left: 10px;
      }

      .comment-group {
        background-color: white;
        border-radius: 20px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        padding: 20px 30px;
        margin-bottom: 0px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .comment-item .profile-img-small {
        flex-shrink: 0;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        margin-left: 0;
        margin-top: 4px;
      }

      .comment-content-area {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .comment-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
        font-size: 14px;
        justify-content: space-between;
      }

      .comment-meta .user-info {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .comment-meta .comment-author {
        font-weight: 600;
        color: #000;
      }

      .comment-info-actions {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 13px;
        color: #939393;
        margin-top: 8px;
        margin-bottom: 0px;
      }

      .comment-text {
        font-size: 15px;
        color: #333;
        line-height: 1.6;
        white-space: pre-line;
        margin-bottom: 0px;
      }

      .comment-date {
        color: #939393;
        font-size: 13px;
        white-space: nowrap;
      }

      .reply-button {
        background: none;
        border: none;
        color: #a0a0a0;
        font-size: 13px;
        cursor: pointer;
        padding: 0;
        text-decoration: none;
      }

      .reply-button:hover {
        text-decoration: underline;
      }

      .comment-like-button {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #555;
        font-size: 14px;
        cursor: pointer;
        border: none;
        background: none;
        padding: 0;
      }

      .comment-like-icon {
        width: 18px;
        height: 16px;
      }

      .reply-input-area {
        display: flex;
        align-items: flex-start;
        padding: 10px 40px 10px 180px;
        background-color: white;
        border-bottom: 1px solid #eee;
        border-radius: 0 0 20px 20px;
        margin-top: 0px;
      }

      .reply-input-area .profile-img-small {
        width: 36px;
        height: 36px;
        flex-shrink: 0;
        margin-top: 4px;
      }

      .reply-input-area .reply-input-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-left: 0;
      }

      .reply-input-content input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e1e1e1;
        border-radius: 8px;
        font-size: 15px;
        outline: none;
      }

      .reply-input-content input::placeholder {
        color: #b0b0b0;
      }

      .reply-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .reply-buttons button {
        padding: 8px 15px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        border: 1px solid #e1e1e1;
      }

      .reply-buttons .submit-reply {
        background-color: #247eb6;
        color: white;
        border-color: #247eb6;
      }

      .reply-buttons .cancel-reply {
        background-color: white;
        color: #555;
      }

      .reply-comment-item {
        margin-left: 40px;
        padding-left: 25px;
        position: relative;
      }

      .reply-arrow-image {
        position: absolute;
        left: -20px;
        top: 14px;
        width: 20px;
        height: 20px;
      }
      a {
        text-decoration: none;
        color: inherit;
      }
    </style>
  </head>

  <body>
    <div class="blur-circle blur-circle-1"></div>
    <div class="blur-circle blur-circle-2"></div>
    <div class="header">
      <div class="logo">
        <img src="./icons/tutti.png" alt="Tutti 로고" />
      </div>
      <div class="user-actions">
        <a href="CommuForm.html">
          <div class="nav-box">홈</div>
        </a>
        <a href="notification.html">
          <div class="nav-box notification">
            알림
            <span class="badge">0</span>
          </div>
        </a>
        <a href="MyPage.html">
          <div class="profile-btn">
            <img id="profileImage" src="./icons/profile.png" alt="프로필" />
          </div>
        </a>
      </div>
    </div>

    <div class="wrapper">
      <div class="sidebar">
        <h2>TOEIC 커뮤니티</h2>
        <div class="stats">
          <div class="stat-item">
            <img src="./icons/user.png" class="user-icon" alt="유저 아이콘" />
            <span>00명</span>
          </div>
          <div class="stat-item">
            <img
              src="./icons/calendar-blue.png"
              class="calendar-icon"
              alt="달력 아이콘"
            />
            <span>0/00</span>
          </div>
          <div class="stat-item">
            <img src="./icons/day.png" class="day-icon" alt="D-day 아이콘" />
            <span>-61</span>
          </div>
        </div>

        <div class="write-button" onclick="location.href='PostUpload.html'">
          <img src="./icons/pencil.png" alt="글쓰기 아이콘" />
          <span>글쓰기</span>
        </div>

        <ul id="menu-list">
          <a href="Community.html"
            ><li data-title="전체글" data-icon="all">
              <img src="./icons/all-gray.png" class="icon-all" />
              <span>전체글</span>
            </li></a
          >
          <a href="hot.html?category=인기글"
            ><li data-title="인기글" data-icon="star">
              <img src="./icons/star-gray.png" class="icon-star" />
              <span>인기글</span>
            </li></a
          >
          <a href="information.html?category=정보글"
            ><li data-title="정보글" data-icon="info" class="active">
              <img src="./icons/info-blue.png" class="icon-info" />
              <span>정보글</span>
            </li></a
          >
          <a href="group.html?category=스터디 모집"
            ><li data-title="스터디 모집" data-icon="group">
              <img src="./icons/group-gray.png" class="icon-group" />
              <span>스터디 모집</span>
            </li></a
          >
          <a href="mission.html"
            ><li data-title="미션" data-icon="mission">
              <img src="./icons/mission-gray.png" class="icon-mission" />
              <span>미션</span>
            </li></a
          >
          <a href="calendar.html"
            ><li data-title="시험 일정" data-icon="calendar">
              <img src="./icons/calendar-gray.png" class="icon-calendar" />
              <span>시험 일정</span>
            </li></a
          >
        </ul>
      </div>

      <div class="content">
        <div class="post-detail">
          <div class="post-header">
            <a href="community.html">전체글</a> &gt;
            <a href="#" id="post-type-link"
              ><span id="post-type">최신글</span></a
            >
          </div>
          <div class="post-title" id="post-title">로딩 중...</div>
          <div class="meta-and-line">
            <div class="post-meta">
              <div class="profile-and-text">
                <div class="profile-img-small">
                  <img src="./icons/profile.png" alt="작성자 프로필" />
                </div>
                <div class="text-container">
                  <span id="post-writer"></span>
                  <span id="post-date"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="post-content" id="post-content">
            게시물 내용을 불러오는 중입니다.
          </div>

          <div class="post-actions">
            <div class="left-actions">
              <div class="action-item" id="like-button">
                <img
                  src="./icons/heart-gray.png"
                  alt="좋아요"
                  id="like-icon"
                  class="heart-icon"
                />
                <span id="like-count">0</span>
              </div>
              <div class="action-item">
                <img
                  src="./icons/comment.png"
                  alt="댓글"
                  class="comment-icon"
                />
                <span id="comment-count">0</span>
              </div>
            </div>

            <div class="right-actions">
              <div class="action-item" id="bookmark-button">
                <img
                  src="./icons/saved-white.png"
                  alt="스크랩"
                  id="bookmark-icon"
                  class="bookmark-icon"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="comments-section">
          <div class="comments-list" id="comments-list"></div>
          <div class="comment-input-area">
            <div class="profile-img-small">
              <img
                id="myProfileImage"
                src="./icons/profile.png"
                alt="내 프로필"
              />
            </div>
            <input
              type="text"
              id="comment-input"
              placeholder="댓글을 남겨주세요..."
            />
            <button id="submit-comment">등록</button>
          </div>
        </div>
      </div>
    </div>
    <script src="./config.js"></script>

    <script>
      const currentUserName = sessionStorage.getItem("userName") || "익명";

      const postId = 2;
      const communityId = 1;
      let currentPost;
      let commentLikes = {};
      const token = localStorage.getItem("accessToken");

      fetch(
        `${window.BASE_URL}/api/communities/${communityId}/posts/${postId}`,
        {
          method: "GET",
          headers: {
            Authorization: `Bearer ${token}`,
          },
        }
      )
        .then((res) => res.json())
        .then((response) => {
          const data = response.data;
          currentPost = data;

          document.getElementById("post-title").innerText = data.title;
          document.getElementById("post-writer").innerText = data.writer;
          document.getElementById("post-date").innerText = "작성일 정보 없음";
          document.getElementById("post-content").innerHTML =
            data.content.replace(/\n/g, "<br>");

          updateActionCounts(data);
          renderComments(data.comments || []);

          setupLikeButton();
          setupBookmarkButton();
          setupCommentInput();
        })
        .catch((err) => {
          console.error("게시글을 불러오는 중 오류 발생:", err);
          alert("게시글을 불러올 수 없습니다.");
        });

      function updateActionCounts(post) {
        document.getElementById("like-count").innerText = post.likes || 0;
        document.getElementById("comment-count").innerText = (
          post.comments || []
        ).length;
      }

      function renderComments(comments) {
        const commentsList = document.getElementById("comments-list");
        commentsList.innerHTML = "";

        const topLevelComments = comments.filter((c) => c.parentId === null);

        topLevelComments.forEach((mainComment) => {
          const commentGroup = document.createElement("div");
          commentGroup.classList.add("comment-group");

          const mainCommentItem = document.createElement("div");
          mainCommentItem.classList.add("comment-item");
          mainCommentItem.dataset.commentId = mainComment.id;

          const isMainCommentLiked = commentLikes[mainComment.id] || false;
          const mainLikeIconSrc = isMainCommentLiked
            ? "./icons/heart-blue.png"
            : "./icons/heart-gray.png";

          mainCommentItem.innerHTML = `
      <div class="profile-img-small">
        <img src="./icons/profile.png" alt="프로필" />
      </div>
      <div class="comment-content-area">
        <div class="comment-meta">
          <div class="user-info">
            <span class="comment-author">${mainComment.author}</span>
          </div>
          <button class="comment-like-button" data-comment-id="${
            mainComment.id
          }">
            <img src="${mainLikeIconSrc}" alt="좋아요" class="comment-like-icon" />
            <span class="comment-like-count">${mainComment.likes || 0}</span>
          </button>
        </div>
        <div class="comment-text">${mainComment.text.replace(
          /\n/g,
          "<br>"
        )}</div>
        <div class="comment-info-actions">
          <span class="comment-date">${mainComment.date || "날짜 없음"}</span>
          <button class="reply-button" data-comment-id="${
            mainComment.id
          }">답글달기</button>
        </div>
      </div>`;

          commentGroup.appendChild(mainCommentItem);

          comments
            .filter((c) => c.parentId === mainComment.id)
            .forEach((reply) => {
              const replyItem = document.createElement("div");
              replyItem.classList.add("comment-item", "reply-comment-item");
              replyItem.dataset.commentId = reply.id;

              const isReplyLiked = commentLikes[reply.id] || false;
              const replyLikeIconSrc = isReplyLiked
                ? "./icons/heart-blue.png"
                : "./icons/heart-gray.png";

              replyItem.innerHTML = `
        <img src="./icons/point.png" alt="답글 화살표" class="reply-arrow-image">
        <div class="profile-img-small">
          <img src="./icons/profile.png" alt="프로필" />
        </div>
        <div class="comment-content-area">
          <div class="comment-meta">
            <div class="user-info">
              <span class="comment-author">${reply.author}</span>
            </div>
            <button class="comment-like-button" data-comment-id="${reply.id}">
              <img src="${replyLikeIconSrc}" alt="좋아요" class="comment-like-icon" />
              <span class="comment-like-count">${reply.likes || 0}</span>
            </button>
          </div>
          <div class="comment-text">${reply.text.replace(/\n/g, "<br>")}</div>
          <div class="comment-info-actions">
            <span class="comment-date">${reply.date || "날짜 없음"}</span>
            <button class="reply-button" data-comment-id="${
              reply.id
            }">답글달기</button>
          </div>
        </div>`;

              commentGroup.appendChild(replyItem);
            });

          commentsList.appendChild(commentGroup);
        });

        attachCommentEventListeners();
      }

      function attachCommentEventListeners() {
        document.querySelectorAll(".comment-like-button").forEach((button) => {
          button.onclick = null;
          button.addEventListener("click", function () {
            const commentId = parseInt(this.dataset.commentId);
            const isCurrentlyLiked = commentLikes[commentId] || false;

            commentLikes[commentId] = !isCurrentlyLiked;

            const likeCountSpan = this.querySelector(".comment-like-count");
            const likeIconImg = this.querySelector(".comment-like-icon");

            const comment = currentPost.comments.find(
              (c) => c.id === commentId
            );
            if (comment) {
              if (commentLikes[commentId]) {
                comment.likes = (comment.likes || 0) + 1;
                likeIconImg.src = "./icons/heart-blue.png";
              } else {
                comment.likes = Math.max(0, (comment.likes || 0) - 1);
                likeIconImg.src = "./icons/heart-gray.png";
              }
              likeCountSpan.innerText = comment.likes;
            }
          });
        });

        document.querySelectorAll(".reply-button").forEach((button) => {
          button.onclick = null;
          button.addEventListener("click", function () {
            const parentCommentItem = this.closest(".comment-item");
            const commentId = parentCommentItem.dataset.commentId;

            const existingReplyArea =
              document.querySelector(".reply-input-area");
            if (existingReplyArea) existingReplyArea.remove();

            const replyInputArea = document.createElement("div");
            replyInputArea.classList.add("reply-input-area");
            replyInputArea.innerHTML = `
        <div class="profile-img-small">
          <img id="myReplyProfileImage" src="./icons/profile.png" alt="내 프로필" />
        </div>
        <div class="reply-input-content">
          <input type="text" placeholder="답글을 남겨주세요..." data-parent-comment-id="${commentId}" />
          <div class="reply-buttons">
            <button class="cancel-reply">취소</button>
            <button class="submit-reply">등록</button>
          </div>
        </div>`;

            parentCommentItem.after(replyInputArea);

            const profileImg = replyInputArea.querySelector(
              "#myReplyProfileImage"
            );
            profileImg.src = "./icons/profile123.png";

            const submitBtn = replyInputArea.querySelector(".submit-reply");
            const cancelBtn = replyInputArea.querySelector(".cancel-reply");
            const inputField = replyInputArea.querySelector("input");

            submitBtn.addEventListener("click", () => {
              const replyText = inputField.value.trim();
              if (replyText) {
                const now = new Date();
                const dateString = `${now.getFullYear()}년 ${
                  now.getMonth() + 1
                }월 ${now.getDate()}일 ${now.getHours()}:${now
                  .getMinutes()
                  .toString()
                  .padStart(2, "0")}`;
                const newReply = {
                  id: Date.now(),
                  author: sessionStorage.getItem("userName") || "익명",
                  text: replyText,
                  date: dateString,
                  likes: 0,
                  parentId: parseInt(commentId),
                };
                currentPost.comments.push(newReply);
                renderComments(currentPost.comments);
                updateActionCounts(currentPost);
              }
              replyInputArea.remove();
            });

            cancelBtn.addEventListener("click", () => replyInputArea.remove());
            inputField.focus();
          });
        });
      }

      function setupLikeButton() {
        let isPostLiked = false;
        const likeButton = document.getElementById("like-button");
        const likeIcon = document.getElementById("like-icon");

        likeButton.addEventListener("click", () => {
          isPostLiked = !isPostLiked;
          likeIcon.src = isPostLiked
            ? "./icons/heart-blue.png"
            : "./icons/heart-gray.png";
          currentPost.likes += isPostLiked ? 1 : -1;
          document.getElementById("like-count").innerText = currentPost.likes;
        });
      }

      function setupBookmarkButton() {
        let isBookmarked = false;
        const bookmarkButton = document.getElementById("bookmark-button");
        const bookmarkIcon = document.getElementById("bookmark-icon");
        bookmarkIcon.src = "./icons/saved-white.png";

        bookmarkButton.addEventListener("click", () => {
          isBookmarked = !isBookmarked;
          bookmarkIcon.src = isBookmarked
            ? "./icons/saved-blue.png"
            : "./icons/saved-white.png";
          console.log(
            isBookmarked
              ? "게시물이 스크랩되었습니다."
              : "게시물 스크랩이 해제되었습니다."
          );
        });
      }

      function setupCommentInput() {
        const commentInput = document.getElementById("comment-input");
        const submitCommentButton = document.getElementById("submit-comment");
        const userName = sessionStorage.getItem("userName") || "익명";

        submitCommentButton.addEventListener("click", () => {
          const commentText = commentInput.value.trim();
          if (commentText) {
            const now = new Date();
            const dateString = `${now.getFullYear()}년 ${
              now.getMonth() + 1
            }월 ${now.getDate()}일 ${now.getHours()}:${now
              .getMinutes()
              .toString()
              .padStart(2, "0")}`;
            const newComment = {
              id: Date.now(),
              author: userName,
              text: commentText,
              date: dateString,
              likes: 0,
              parentId: null,
            };
            currentPost.comments.push(newComment);
            renderComments(currentPost.comments);
            updateActionCounts(currentPost);
            commentInput.value = "";
          }
        });
      }
    </script>
  </body>
</html>
